---
title: "Titanic Competition"
author: "Valentin Henriot"
date: "6/30/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE)
```

```{r}
library(tidyverse)
library(ggplot2)
library(readr)
```

# Download and reshape data

```{r}
train.data <- read_csv("~/Desktop/ProjectR/DataBase/trainTitanic.csv")
test.data <- read_csv("~/Desktop/ProjectR/DataBase/testTitanic.csv")
```

```{r}
train.data$Survived <- as.logical(train.data$Survived)
train.data$PassengerId <- as.character(train.data$PassengerId)
train.data$Pclass <- as.factor(train.data$Pclass)
train.data$Sex <- as.factor(train.data$Sex)
```

```{r}
summary(train.data)
```

# Basics ratios

```{r Men Survival Ratio}
ManSurvival <- filter(train.data, Sex == "male" & Survived == TRUE)
ManSurvivalCount <- nrow(ManSurvival)

ManTotal <- filter(train.data, Sex == "male")
ManTotalCount <- nrow(ManTotal)

RatioSurvivedMan <- ManSurvivalCount/ManTotalCount

print(paste("% of men who survived", RatioSurvivedMan))
```

```{r Women Survival Ratio}
WomanSurvival <- filter(train.data, Sex == "female" & Survived == TRUE)
WomanSurvivalCount <- nrow(WomanSurvival)

WomanTotal <- filter(train.data, Sex == "female")
WomanTotalCount <- nrow(WomanTotal)

RatioSurvivedWoman <- WomanSurvivalCount/WomanTotalCount

print(paste("% of women who survived", RatioSurvivedWoman))
```

```{r First class Survival Ratio}
FirstClassSurvival <- filter(train.data, Pclass == "1" & Survived == TRUE)
FirstClassSurvivalCount <- nrow(FirstClassSurvival)

FirstClassTotal <- filter(train.data, Pclass == "1")
FirstClassTotalCount <- nrow(FirstClassTotal)

RatioSurvivedFirstClass <- FirstClassSurvivalCount/FirstClassTotalCount

print(paste("% of 1st class passengers who survived", RatioSurvivedFirstClass))
```

```{r Second class Survival Ratio}
SecondClassSurvival <- filter(train.data, Pclass == "2" & Survived == TRUE)
SecondClassSurvivalCount <- nrow(SecondClassSurvival)

SecondClassTotal <- filter(train.data, Pclass == "2")
SecondClassTotalCount <- nrow(SecondClassTotal)

RatioSurvivedSecondClass <- SecondClassSurvivalCount/SecondClassTotalCount

print(paste("% of 2nd class passengers who survived", RatioSurvivedSecondClass))
```

```{r Third class Survival Ratio}
ThirdClassSurvival <- filter(train.data, Pclass == "3" & Survived == TRUE)
ThirdClassSurvivalCount <- nrow(ThirdClassSurvival)

ThirdClassTotal <- filter(train.data, Pclass == "3")
ThirdClassTotalCount <- nrow(ThirdClassTotal)

RatioSurvivedThirdClass <- ThirdClassSurvivalCount/ThirdClassTotalCount

print(paste("% of 3rd class passengers who survived", RatioSurvivedThirdClass))
```

```{r}
RatioSurvivedMan <- as.data.frame(RatioSurvivedMan)
RatioSurvivedWoman <- as.data.frame(RatioSurvivedWoman)
RatioSurvivedFirstClass <- as.data.frame(RatioSurvivedFirstClass)
RatioSurvivedSecondClass <- as.data.frame(RatioSurvivedSecondClass)
RatioSurvivedThirdClass <- as.data.frame(RatioSurvivedThirdClass)

RatioSurvived <- bind_cols(RatioSurvivedMan, RatioSurvivedWoman, RatioSurvivedFirstClass, RatioSurvivedSecondClass, RatioSurvivedThirdClass) %>% gather(key = "Category", value = "Value")

RatioSurvived$Category <- recode(RatioSurvived$Category, "RatioSurvivedMan" = "Man", "RatioSurvivedWoman" ="Woman", "RatioSurvivedFirstClass" = "First Class", "RatioSurvivedSecondClass" = "Second Class", "RatioSurvivedThirdClass" = "Third Class")
```

```{r}
ggplot(RatioSurvived) +
 aes(x = reorder(Category, -Value), fill = Value, weight = Value) +
 geom_bar() +
 scale_fill_viridis_c(option = "inferno") +
 labs(y = "Rate in %", title = "Survival Ratio by category") +
 ggthemes::theme_stata()
```

```{r}
sum(is.na(train.data$Age))
sum(is.na(train.data$Cabin))
```

### Faire des catégories d'âge

```{r}
train.data$Class.Age <- cut(train.data$Age, breaks = c(0, 5, 17, 30, 50, 81),include.lowest = TRUE)
```

### Faire une colonne avec Mr, Miss, etc

### Regarder pour faire un arbre de décision (random forest ?)